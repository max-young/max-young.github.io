---
layout: default
---

<link rel="stylesheet" href="/css/blog.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

{% if page.header-img %}
<div class="post-photo" style="background-image: url('/images/posts/{{ page.header-img }}')">
</div>
{% endif %}

<div id="container">
<article>
<div class="inner">
<div class = "post-header">
  <h1>
    {{ page.title }}
  </h1>
  <h4>{{ page.subtitle }}</h4>
  <ul class="meta">
  	<i class="fa fa-calendar"></i>
  	{{ page.date | date: "%Y" }}-{{ page.date | date: "%m" }}-{{ page.date | date: "%d" }}
  	<i class="space"></i>
  	<i class="fa fa-archive"></i>
  	<a class="tag" href="{{ site.url }}/blog/categories.html#{{ page.categories }}">{{ page.categories }}</a>
  	<i class="space"></i>
  	<i class="fa fa-tags"></i>
  	{% for tag in page.tags %}
  	    <a class="tag" href="{{ site.url }}/blog/tags.html#{{ tag }}">{{ tag }}</a>
  	    <i class="space"></i>
  	{% endfor %}
  	<!-- <i class="space"></i> 字数:{{page.content | size |divided_by:2}} -->
  </ul>
</div>
</div>

  <div class="post">
        <div class ="sidebox">
            <!-- <div class ="sidebar">
              <strong>Table of Contents</strong>
            </div> -->
            <div class="toc">
              <!-- <p id="debug-info">Loading TOC...</p> -->
            </div>
        </div>
        <div id="content">
  	   {{ content }}
  	</div>
	</div>

<!-- {% include new-old.html %} -->

</article>

<!--翻页功能-->
<!-- <section class="inner">
<ul class="pager">
    {% if page.previous.url %}
    <li class="previous">
       <a href="{{page.previous.url}}">←{{page.previous.title}}</a>
    </li>
    {% endif %}
    {% if page.next.url %}
    <li class="next">
    	<a href="{{page.next.url}}">{{page.next.title}}→</a>
    </li>
    {% endif %}
 </ul>
</section> -->

<!-- <section class="inner" style="margin-top: 3em;">
<div id="gitalk-container">
</div>
</section> -->
</div>

<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    displayMath: [['$$','$$']],
    <!--displayMath: [['$$','$$'], ['\[','\]']],-->
    processEscapes: true,
    processEnvironments: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
    TeX: { equationNumbers: { autoNumber: "AMS" },
         extensions: ["AMSmath.js", "AMSsymbols.js"] }
  }
});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    // Fix <code> tags after MathJax finishes running. This is a
    // hack to overcome a shortcoming of Markdown. Discussion at
    // https://github.com/mojombo/jekyll/issues/199
    var all = MathJax.Hub.getAllJax(), i;
    for(i = 0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
    }
});
</script>

<!-- Gitalk start -->
<!-- <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> 
<script>
    const gitalk  = new Gitalk ({
        id: decodeURI(window.location.pathname),
        clientID: '{{ site.comment_gitalk_clientId }}',
        clientSecret: '{{ site.comment_gitalk_clientSecret }}',
        repo: '{{ site.comment_gitalk_repo }}',
        owner: '{{ site.github_username }}',
        admin: ['{{ site.github_username }}'],
		    distractionFreeMode: false
    })
    gitalk.render('gitalk-container')
</script>  -->
<!-- Gitalk end -->

<!-- Table of Contents JavaScript -->
<script>
function generateTableOfContents() {
  console.log('Starting TOC generation...');
  
  // Wait for all content to be fully loaded
  if (document.readyState !== 'complete') {
    console.log('Document not ready, waiting...');
    setTimeout(generateTableOfContents, 100);
    return;
  }
  
  // Update debug info
  function updateDebug(msg) {
    var debugEl = document.getElementById('debug-info');
    if (debugEl) {
      debugEl.innerHTML = msg;
    }
    console.log('TOC Debug:', msg);
  }
  
  updateDebug('Scanning for headers...');
  
  // Find headers using vanilla JavaScript first
  var allHeaders = document.querySelectorAll('h1, h2, h3, h4, h5, h6');
  var contentHeaders = document.querySelectorAll('#content h1, #content h2, #content h3, #content h4, #content h5, #content h6');
  var articleHeaders = document.querySelectorAll('article h1, article h2, article h3, article h4, article h5, article h6');
  
  updateDebug('Found headers - All: ' + allHeaders.length + ', Content: ' + contentHeaders.length + ', Article: ' + articleHeaders.length);
  
  // Choose the best set of headers (exclude page title)
  var headers = contentHeaders.length > 0 ? contentHeaders : 
                articleHeaders.length > 1 ? Array.from(articleHeaders).slice(1) : // Skip first h1 (page title)
                allHeaders.length > 1 ? Array.from(allHeaders).slice(1) : [];
  
  if (headers.length === 0) {
    updateDebug('No content headers found');
    document.querySelector('.sidebox').style.display = 'none';
    return;
  }
  
  updateDebug('Processing ' + headers.length + ' headers...');
  
  // Generate TOC HTML
  var tocHTML = '<ul>';
  var headerTexts = [];
  
  for (var i = 0; i < headers.length; i++) {
    var header = headers[i];
    var text = header.textContent || header.innerText;
    var level = parseInt(header.tagName.charAt(1));
    
    // Create ID if it doesn't exist
    if (!header.id) {
      var id = text.toLowerCase()
        .replace(/[^\w\s-]/g, '')
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-')
        .replace(/^-+|-+$/g, '');
      header.id = id || 'header-' + i;
    }
    
    headerTexts.push(header.tagName + ': "' + text + '"');
    tocHTML += '<li class="toc-h' + level + '"><a href="#' + header.id + '">' + text + '</a></li>';
  }
  
  tocHTML += '</ul>';
  
  updateDebug('Generated TOC with headers: ' + headerTexts.join(', '));
  
  // Insert TOC
  var tocContainer = document.querySelector('.toc');
  if (tocContainer) {
    tocContainer.innerHTML = tocHTML;
    updateDebug('TOC inserted successfully!');
    
    // Add click handlers
    var tocLinks = tocContainer.querySelectorAll('a');
    for (var j = 0; j < tocLinks.length; j++) {
      tocLinks[j].addEventListener('click', function(e) {
        e.preventDefault();
        var targetId = this.getAttribute('href').substring(1);
        var target = document.getElementById(targetId);
        if (target) {
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
          window.history.pushState(null, null, '#' + targetId);
        }
      });
    }
  } else {
    updateDebug('TOC container not found!');
  }
}

// Try multiple approaches to ensure the TOC loads
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', generateTableOfContents);
} else {
  generateTableOfContents();
}

// Also try with jQuery if available
if (typeof $ !== 'undefined') {
  $(document).ready(function() {
    setTimeout(generateTableOfContents, 500);
    setTimeout(generateTableOfContents, 1500);
  });
} else {
  // Fallback without jQuery
  setTimeout(generateTableOfContents, 500);
  setTimeout(generateTableOfContents, 1500);
  setTimeout(generateTableOfContents, 3000);
}
</script>
