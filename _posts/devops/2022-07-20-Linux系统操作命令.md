---
layout:     post
title:      "Linux系统操作命令"
date:       2022-07-20
categories: Linux
tags:
    - CentOS
    - Ubuntu
---

<!-- TOC -->

- [基础知识](#基础知识)
  - [shell以及zsh](#shell以及zsh)
- [系统相关](#系统相关)
  - [查看Linux内核版本和CentOS版本](#查看linux内核版本和centos版本)
  - [用户](#用户)
- [网络与连接](#网络与连接)
  - [SSH连接远程服务器](#ssh连接远程服务器)
  - [网络IP相关命令](#网络ip相关命令)
  - [SCP文件传输](#scp文件传输)
  - [开通端口](#开通端口)
- [文件相关](#文件相关)
  - [查找文件](#查找文件)
  - [查看文件内容](#查看文件内容)
  - [打包与解压](#打包与解压)
  - [路径](#路径)
- [进程](#进程)
  - [查看python进程](#查看python进程)
- [权限](#权限)
  - [无法cd到某些路径，Permission Denied](#无法cd到某些路径permission-denied)
  - [更改文件的用户](#更改文件的用户)

<!-- /TOC -->

<a id="markdown-基础知识" name="基础知识"></a>
#### 基础知识

命令前加上`bash -x`可以输出命令的执行过程

<a id="markdown-shell以及zsh" name="shell以及zsh"></a>
##### shell以及zsh    

[http://macshuo.com/?p=676](http://macshuo.com/?p=676)    

参考书：[Linux命令行与shell脚本编程大全](https://book.douban.com/subject/11589828/)

***
<a id="markdown-系统相关" name="系统相关"></a>
#### 系统相关  

<a id="markdown-查看linux内核版本和centos版本" name="查看linux内核版本和centos版本"></a>
##### 查看Linux内核版本和CentOS版本

1. 查看CentOS版本

   ```shell
   $ cat /etc/centos-release
   # 或者
   $ cat /etc/redhat-release
   Red Hat Enterprise Linux Server release 7.2 (Maipo)
   ```

2. 查看内核版本

   ```shell
   $ uname -a
   Linux dscn3 3.10.0-327.el7.x86_64 #1 SMP Thu Oct 29 17:29:29 EDT 2015 x86_64 x86_64 x86_64 GNU/Linux
   ```

3. 查看Ubuntu版本

```shell
$ lsb_release -a
```

***

<a id="markdown-用户" name="用户"></a>
##### 用户

- 显示用户

  ```shell
  $ cat /etc/passwd
  ```

- 删除用户

  ```shell
  # remove the user’s home directory and mail spool pass the -r option to userdel
  $ userdel -r username
  ```

- 增加用户

  ```shell
  # 增加用户
  $ useradd username
  # 设置密码
  $ passwd username
  ```

- 修改用户密码

  ```shell
  # 修改其他用户密码
  sudo passwd <user>
  ```

****

<a id="markdown-网络与连接" name="网络与连接"></a>
#### 网络与连接  

<a id="markdown-ssh连接远程服务器" name="ssh连接远程服务器"></a>
##### SSH连接远程服务器

[How To Use SSH to Connect to a Remote Server in Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-use-ssh-to-connect-to-a-remote-server-in-ubuntu)

我们用`ssh`命令能登录远程服务器，例如：    

```shell
$ ssh root@123.45.12.145
```

> 需要注意的是，ssh的默认端口是22，有的服务器设置的端口不是22，那么连接的时候就需要指定端口，例如：  
>
> ```shell
> $ ssh -p 2222 root@123.45.12.145
> ```

然后系统会提示输入密码，每次输入密码很麻烦，我们 可以这样    

```
$ ssh-copy-id root@123.45.12.145
```

按提示输入密码后，重启中断，再次ssh登录此服务器，就不用输入密码了。

登录密码很长，输入很麻烦，怎么办？我们可以编辑`~/.bashrc`，加入此登录命令的快捷命令，例如：    

```
alias root_hulumei="ssh root@123.56.142.59"
```

- WARNING: REMOTE HOST IDENTIFICATION HAS CHANGED!

  参考资料：<http://stackoverflow.com/questions/20840012/ssh-remote-host-identification-has-changed>

  ```shell
  $ ssh-keygen -R <host>
  ```
- 连接不上, 没反应
  
  可能是22端口没打开, 如何打开端口, 这篇文章里有讲到

- connection refused

  ssh连接服务器时报这个错, 可能是这个服务器的ssh server没打开, 用这个命令查看:
  ```shell
  sudo apt-get install openssh-server
  ```
  如果没有打开, 则需要按照ssh-server:
  ```shell
  sudo apt-get install openssh-server
  ```

<a id="markdown-网络ip相关命令" name="网络ip相关命令"></a>
##### 网络IP相关命令

参考资料：<http://www.cnblogs.com/kaiye/archive/2013/05/25/3099393.html>

- 查看端口占用情况：

  ```shell
  $ lsof -i:<port>
  ```
- 查看localhost ip：

  ```shell
  $ hostname -I
  ```

<a id="markdown-scp文件传输" name="scp文件传输"></a>
##### SCP文件传输

安装(CentOS)：

```shell
$ yum -y install openssh-clients
```

需要相互通信的服务器都要安装

<a id="markdown-开通端口" name="开通端口"></a>
##### 开通端口

Ubuntu
```shell
# 查看已经开启的端口
sudo ufw status
# 打开端口
sudo ufw allow <port>
# 开启防火墙
sudo ufw enable
# 重启防火墙
sudo ufw reload
# 再次查看端口是否已开启
sudo ufw status
```

***

<a id="markdown-文件相关" name="文件相关"></a>
#### 文件相关  

<a id="markdown-查找文件" name="查找文件"></a>
##### 查找文件

- which查找可执行文件，根据可执行文件的文件名。例如：

  ```shell
  $ which mysqld
  ```

- 查找路径下包含某内容的文件    

  ```shell
  # 在当前路径下查找包含content的文件
  $ grep -r "content" .
  ```

<a id="markdown-查看文件内容" name="查看文件内容"></a>
##### 查看文件内容    

- 查看文件的全部内容    

  ```shell
  $ cat app.py
  ```

- 如果你只想看文件的前5行，可以使用head命令，如：    

  ```shell
  $ head -5 app.py
  ```

- 如果你想查看文件的后10行，可以使用tail命令，如：     

  ```shell
  $ tail -20 /etc/passwd 
  ```

- 参数-f使tail不停地去读最新的内容，这样有实时监视的效果 

  ```shell
  $ tail -f /var/log/messages
  ```

<a id="markdown-打包与解压" name="打包与解压"></a>
##### 打包与解压  

- tar

  [Tar Command Examples in Linux](https://www.tecmint.com/18-tar-command-examples-in-linux/)  

  > The Linux “**tar**” stands for tape archive, which is used by large number of **Linux/Unix** system administrators to deal with tape drives backup. The tar command used to rip a collection of files and directories into highly compressed archive file commonly called **tarball** or **tar**, **gzip** and **bzip** in **Linux**. The tar is most widely used command to create compressed archive files and that can be moved easily from one disk to another disk or machine to machine.

  -  参数解释  

    **x** – extract释放

    **v** – Verbosely show the .tar file progress显示解压过程

    **f**  – File name type of the archive file使用档案文件或设备，这个选项通常是必选的  

    **C**  – specified directory指定路径


  - 解压缩

    ```shell
    # 解压到当前路径
    $ tar -xvf public_html-14-09-12.tar
    # 解压到指定路径
    $ tar -xvf public_html-14-09-12.tar -C /home/public_html/videos/
    ```

<a id="markdown-路径" name="路径"></a>
##### 路径

- mkdir

  ```shell
  # 创建多层级路径
  $ mkdir -p /home/work/bin/ksxing-web
  ```

- 查看路径下的全部内容，并exclude某路径  

  ```shell
  # 查看当前路径下的所有文件，并不查看venv这个路径
  $ find . -path ./venv -prune -o -print
  ```

****

<a id="markdown-进程" name="进程"></a>
#### 进程

<a id="markdown-查看python进程" name="查看python进程"></a>
##### 查看python进程    

```shell
$ netstat -pln|grep python
```
****

<a id="markdown-权限" name="权限"></a>
#### 权限

<a id="markdown-无法cd到某些路径permission-denied" name="无法cd到某些路径permission-denied"></a>
##### 无法cd到某些路径，Permission Denied

[http://unix.stackexchange.com/questions/320011/permission-denied-cd-into-directory](http://unix.stackexchange.com/questions/320011/permission-denied-cd-into-directory)

```shell
$ chmod go+rx /dir
```

<a id="markdown-更改文件的用户" name="更改文件的用户"></a>
##### 更改文件的用户

`ll`可以看到文件的用户和组信息, 如果是root用户, 权限较高, 可能某些场景下会有问题.  
我们可以修改成当前用户:
```shell
sudo chown -R max:max /data/product
```